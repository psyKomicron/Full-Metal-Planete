using Full_Metal_Planete.src.decorators;
using System.Collections.ObjectModel;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;

namespace Full_Metal_Planete.src.user_controls
{
    /// <summary>
    /// Logique d'interaction pour UnitListView.xaml
    /// </summary>
    public partial class UnitListView : UserControl
    {
        private ObservableCollection<UnitIHM> units;

        public ObservableCollection<UnitIHM> Entities => units;

        public UnitListView()
        {
            InitializeComponent();
            units = new ObservableCollection<UnitIHM>();
            playersListView.ItemsSource = units;
        }

        public void AddUnit(UnitIHM unitIHM)
        {
            units.Add(unitIHM);
        }

        public void RemoveUnit()
        {
            units.Remove((UnitIHM)playersListView.SelectedItem);
        }

        protected override void OnMouseMove(MouseEventArgs e)
        {
            base.OnMouseMove(e);
            if (e.LeftButton == MouseButtonState.Pressed && playersListView.SelectedItem != null)
            {
                UnitIHM unitIHM = (UnitIHM)playersListView.SelectedItem;
                DataObject data = new DataObject();
                data.SetData("Object", unitIHM);
                data.SetData("TypeEntite", unitIHM.Type);
                DragDrop.DoDragDrop(this, data, DragDropEffects.Move);
            }
        }

        protected override void OnDrop(DragEventArgs e)
        {
            base.OnDrop(e);
            if (e.Data.GetDataPresent("Object"))
            {
                UnitIHM unit = (UnitIHM)e.Data.GetData("Object");
                units.Add(unit);
            }
            e.Handled = true;
        }

        private void playersListView_RequestBringIntoView(object sender, RequestBringIntoViewEventArgs e)
        {
            e.Handled = true;
        }
    }
}
